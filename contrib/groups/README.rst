groups
======

This is for group assignments.

If you are a TA who just wants to grade submissions, you can jump to step 5.
If you are a course responsible or a TA who is preparing the grading of a
group assignment, start at step 0.

Step 0: Assignment creation on Absalon
--------------------------------------

When creating a new assignment on Absalon, we make sure to tick the
box that makes it a group assignment, and create a new group category
'Assignment N Groups', where N is the assignment number. This is
important because once submissions have been uploaded, it cannot be
changed into a group assignment.  **Warning:** the group category
created during this step is the means by which Staffeli automatically
assigns the same grade to all participants of group members in that
category.  Do *not* delete the category, as this will break this
property.  Recreating it under the same name is not sufficient
(although it will look that way in the web UI).


Step 1: Handing uploading
-------------------------

Students upload their submissions, possibly containing `group.txt` files.


Step 2: Downloading
-------------------

We fetch all handins::

  staffeli fetch subs/N

where N is likely just a number.  For example, if the assignment name on Absalon
is 'Assignment 3: Rabbit drawing', then N can be 3.  You can also use longer
patterns if necessary.


Step 3: Groups
--------------

We split them into groups.

First we find all groups::

  find-groups.sh subs/N > subs/N/groups.txt

Then we check if the groups make sense::

  check-groups.py subs/N/groups.txt

If this script doesn't print any errors, then the groups are probably fine.

We then need to create the groups on Absalon, so that all group members will be
registered as having submitted, and so that all group members can see our
feedback when it comes up.  We also need to have the groups available locally.
We run::

  create-groups.py subs/N/ 'Assignment N Groups' subs/N/groups.txt

where the first argument is the directory with assignments fetched in step 2,
the second argument is the group category name created on Absalon in step 0,
and the third argument is the `groups.txt` generated by `find-groups.sh` in
step 3.

This will create groups on Absalon and symlink locally in the ``groupsubs``
directory.


Step 4: Sections
----------------

(Optional.)

We distribute the group submissions into TA sections.  We do this to decide
which TA gets to correct which submissions.  We run::

  split-into-sections.py groupsubs/N subs/N/groups.txt SECTION...

This will symlink submissions in the ``sections`` directory.


Step 5: Grading
---------------

``cd`` to a submission directory, write some feedback, and run::

  staffeli grade GRADE -f feedback.txt

where ``GRADE`` is either ``pass``, ``incomplete`` (resubmit) or ``fail``.
Staffeli knows where to send the feedback based on a hidden file
``.staffeli.yml`` in the directory.

This will upload your feedback as comment.  It is also possible to upload
attachments, but this does not fly after a while, at least not on the KU
instance of Canvas: There appears to be some kind of cumulative limit on the
file sizes one can upload through the API.

When uploading the feedback as a comment, note that the line length is not
fixed.


Step 6: Late submissions and resubmissions
----------------------------------------------

Fetch the subs anew.  Submission files will be put in separate subdirectories if
they already exist.


Helper tools
------------

It can be useful to find out the KU id of a student based on their name.  Run::

  staffeli user find NAME

To find out which group a student is a member of, run::

  groups-search subs/N/groups.txt abc123
